# SPOOLing 技术

## SPOOLing 技术做了什么？

> 共享打印机是使用 SPOOLing 技术的一个实例.当用户进程请求打印输出时，SPOOLing 系统同意为它打印输出，但并不真正 立即把打印机分配给该用户进程，而只为它做两件事：

1.由输出进程在输出井中为之申请一个空闲磁盘块区，并将要打印的数据送入其中。(如果：简单的把输出看作一个队列，那么就是『输出进程』询问『输出缓冲队列』能不能往上面添加一个元素。) 2.『输出进程』再用户进程申请一张空白的用户请求打印表，并将用户的打印要求填入 其中，再将该表挂到请求打印队列上。(『输出进程』把用户想要打印的数据放到一个叫『请求打印表』的数据结构当中，并把这个数据结构放到『输出缓冲队列』的队尾)

SPOOLing 组成：

(1) 输入井和输出井。这是在**磁盘上开辟出来的两个存储区域**。输入井模拟脱机输入时的磁盘，用于收容 I/O 设备输入的**文件**数据。输出井模拟脱机输出时的磁盘，用于收容用户程序的输出的**文件**数据。**输入/输出井中的数据一般以文件的形式组织管理，我们把这些文件称为井文件**。一个文件仅存放某一个进程的输入（或者输出）数据，所有进程的数据输入（或输出）文件链接称为一个**文件输入**（或**文件输出）队列**。

(2)输入缓冲区和输出缓冲区。这是在**内存中开辟的两个缓冲区**，用于缓和 CPU 和磁盘之间速度不匹配的矛盾。输入缓冲区用于暂存由输入设备传送的**数据结构数据**，之后再传送到输入井。输出缓冲区用于暂存从输出井传送的**数据结构数据**（应该是把输出井传出的文件数据，变成数据结构才能放到这个输出缓冲区），之后再传送到输出设备。

(3)输入进程和输出进程。输入进程也称为预输入进程，用于模拟脱机输入时的外围控制机，将用户要求的数据从输入设备传送到输入缓冲区，（中间肯定存在转化）再存放到输入井。当 CPU 需要输入设备时，直接从输入井读入内存。输出进程也称为缓输出进程，用于模拟脱机输出时的外围控制机，把用户要求输入的数据从内存传送并存放到输出井，待输出设备空闲时，再将输出井中的数据经过输出缓冲区输出至输出设备上。（个人觉得输入进程，和输出进程就是两个控制器，说进程说的好像很难理解的亚子 doge）

(4)井管理程序。用于控制作业与磁盘井之间信息的交换。当作业执行过程中向某台设备发出启动输入或输出操作请求时，由操作系统调用井管理程序，由其控制从输入井读取信息或将信息输出至输出井。(这不就是数据转化的函数？NoNoNo 感觉就是把『输入井文件队列』的文件，取出，放到『输出井文件队列』)

简言：SPOOLing 系统下面有这么几个角色：

Part1 部分的角色：

- InputControler 就是负责『包装用户的打印请求』到一个数据结构，并把这个数据结构放到『输入缓冲队列』当中，然后再把这个请求转化为文件，把这个文件放到『输入文件队列』（也叫做输入井）
- InputBuffer 一个输入缓冲队列，队列中的每个元素是不同的用户的打印请求。
- InputElement 负责把用户想要打印的数据存储在这个数据结构当中
- InputElementFile 负责把保存『用户打印请求』的数据结构转化为文件
- InputFilesQueue 输入井(也叫『输入文件队列』)，里面存储的是文件

Part2 部分的角色：

- OutputControler 负责从『输入井』中间取出一个文件，把这个文件放到输出井的『文件队列』，然后从输出井的文件队列中间取出一个文件，把这个文件转化为一个存储了『用户的打印请求』的数据结构，并把这个数据结构放到『输出缓冲队列』，接着，设备从这个输出缓冲队列当中，取出数据，把它打印出来
- OutputFilesQueue 输出井(也叫『输出文件队列』)，里面存储的是文件
- OutputElement 负责把用户想要打印的数据存储在这个数据结构当中
- OutputBuffer 一个输出缓冲队列，队列中的每个元素是不同的用户的打印请求。

Part3 部分角色：
全局的一个函数 MoveHeadToTail()把输入文件队列的头部元素放到输出文件队列的头部元素
